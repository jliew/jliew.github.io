<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

    <title>Turkey COVID-19 Provincial Case Numbers</title>
  </head>
  <body>
    <div id="container" style="width:100%; height:900px;"></div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script>
        $(document).ready(function() {
            var url = 'https://raw.githubusercontent.com/jliew/tr-c19-provincial-case-numbers/master/data/vaka_say%C4%B1s%C4%B1.csv'

            Papa.parse("https://raw.githubusercontent.com/jliew/tr-c19-provincial-case-numbers/master/data/vaka_say%C4%B1s%C4%B1.csv", {
                header: true,
                download: true,
                skipEmptyLines: true,
                complete: function(results) {
                    var provinceDataDict = {};
                    for (var i = 0, len = results.data.length; i < len; i++) {
                        row = results.data[i]

                        if (!(row.data_adi in provinceDataDict)) {
                            provinceDataDict[row.data_adi] = []
                        }

                        data = provinceDataDict[row.data_adi]
                        data.push({
                            x: Date.parse(row.date),
                            y: parseFloat(row.data_detay)
                        })
                        provinceDataDict[row.data_adi] = data
                    }

                    var series = []
                    Object.keys(provinceDataDict).map(function(key, index) {
                        data = provinceDataDict[key]
                        data.sort(function(a, b) {
                            return a.x - b.x;
                        })

                        series.push({
                            name: key,
                            data: data
                        });
                    });

                    Highcharts.chart('container', {
                        chart: {
                            type: 'line'
                        },
                        title: {
                            text: 'Turkey COVID-19 Provincial Case Numbers (per 100k)'
                        },
                        subtitle: {
                            text: '<a href="https://github.com/jliew/tr-c19-provincial-case-numbers">GitHub</a>',
                            useHTML: true
                        },
                        xAxis: {
                            type: 'datetime'
                        },
                        yAxis: {
                            title: {
                                text: 'Case numbers (per 100k)'
                            }
                        },
                        series: series,
                        credits: {
                            text: 'T.C. Sağlık Bakanlığı / Turkey Ministry of Health',
                            href: 'https://covid19.saglik.gov.tr'
                        }
                    });
                }
            });
        })
    </script>
  </body>
</html>